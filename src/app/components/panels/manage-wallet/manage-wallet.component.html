<div
	class="uk-animation-slide-left-small"
	uk-grid
	*transloco="let t"
>
	<div class="uk-width-1-1">
		<h2 class="uk-heading-divider">{{ t('general.manage-wallet') }}</h2>
		@if (!isLedger) {
			<div class="uk-card uk-card-default uk-margin">
				<div class="uk-card-header">
					<h3 class="uk-card-title">Change Wallet Password</h3>
				</div>
				@if (isLocked) {
					<div class="uk-card-body"><span uk-icon="icon: lock;"></span> Unlock wallet to change its password.</div>
				} @else {
					<div class="uk-card-body">
						Update the password used to encrypt the currently active wallet "{{ selectedWalletName }}".
					</div>
					<div class="uk-card-footer uk-text-right@s uk-text-center nlt-button-group">
						<button
							(click)="changePassword()"
							class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1"
						>
							Change Password
						</button>
					</div>
				}
			</div>
		}
		@if (!isLedger) {
			<div class="uk-card uk-card-default uk-margin">
				<div class="uk-card-header">
					<h3 class="uk-card-title">Export Gnault Wallet</h3>
				</div>
				@if (isLocked) {
					<div class="uk-card-body"><span uk-icon="icon: lock;"></span> Unlock wallet to access the export tool.</div>
				} @else {
					<ng-container>
						<div class="uk-card-body">
							Use this export tool to simplify wallet transfer to other devices.<br />Your data will be encrypted with
							your wallet's password, and then can be imported into Gnault on any device!<br /><br />Note: The export
							does not contain your address book.<br />
							@if (showQRExport) {
								<div uk-grid>
									<div class="uk-width-1-1">
										<hr class="uk-divider-icon uk-margin-small-top" />
										<div
											class="uk-alert uk-alert-danger nlt-inline-alert"
											style="max-width: 600px"
										>
											<div class="icon-column">
												<div uk-icon="icon: warning; ratio: 2;"></div>
											</div>
											<p>
												<b
													>If you forget the wallet password used at the time of this export, you will NOT be able to
													restore your wallet.</b
												>
												<br /><br />For backup purposes,
												<b>always store the secret recovery seed and/or mnemonic</b> from the "Backup Wallet" section
												above.
											</p>
										</div>
									</div>
									<div class="uk-width-1-1@s uk-width-1-2@m uk-width-1-3@l">
										<img
											[src]="QRExportImg"
											alt="QR code"
											style="border-radius: 6px"
										/>
									</div>
									<div class="uk-width-1-1@s uk-width-1-2@m uk-width-2-3@l">
										<br />Scan the QR code on any device to import your Gnault wallet!<br />
										<br />You can also import your wallet by using the URL below.<br /><br />
										<input
											type="text"
											class="uk-input"
											style="max-width: 750px"
											value="{{ QRExportUrl }}"
										/>
										<div class="nlt-button-group uk-margin-small-top">
											<button
												ngxClipboard
												[cbContent]="QRExportUrl"
												(cbOnSuccess)="notifications.sendSuccess('Wallet export copied to clipboard!')"
												class="uk-button uk-button-secondary"
												style="margin-left: 0"
											>
												Copy To Clipboard
											</button>
											<button
												(click)="exportToFile()"
												class="uk-button uk-button-primary"
											>
												Export As File
											</button>
										</div>
									</div>
								</div>
							}
						</div>
						@if (!showQRExport) {
							<div class="uk-card-footer uk-text-right@s uk-text-center nlt-button-group">
								<button
									(click)="exportWallet()"
									class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1"
								>
									Export Wallet
								</button>
							</div>
						}
					</ng-container>
					<ng-template #walletHasNoPassword>
						<div class="uk-card-body">
							You need to set a secure wallet password before you can use this export tool.
						</div>
					</ng-template>
				}
			</div>
		}
		<div class="uk-card uk-card-default uk-margin">
			<div class="uk-card-header">
				<h3 class="uk-card-title">Export Transaction History</h3>
			</div>
			@if (!csvExportStarted) {
				<div class="uk-card-body">
					<p>Use this tool to export the transaction history of a specific account as a CSV file.</p>
				</div>
			}
			@if (csvExportStarted) {
				<div class="uk-card-body">
					<p>
						Due to limitations in backend servers, you can only request {{ transactionHistoryLimit }} transactions per
						export.<br />However, you can use an offset of X to continue exporting from (X + 1). Another way is
						connecting Gnault to a
						<a
							routerLink="/configure-app"
							routerLinkActive="active"
							>custom server</a
						>
						for unlimited history.<br />
					</p>
					<div uk-grid>
						<div class="uk-width-1-1 narrow-div">
							<div class="uk-form-horizontal">
								<div class="uk-margin">
									<label
										class="uk-form-label"
										for="account"
										>Account</label
									>
									<div class="uk-form-controls">
										<select
											class="uk-select"
											id="account"
											[(ngModel)]="csvAccount"
										>
											@for (account of accounts; track account.address) {
												<option [value]="account.address">
													{{ account.addressBookName ? account.addressBookName + ' - ' : '#' + account.index + ' - ' }}
													{{ account.address | squeeze }} ({{ account.balance | rai: 'nano,true' | amountsplit: 0
													}}{{ account.balance | rai: 'nano,true' | amountsplit: 1 }} XNO)
												</option>
											}
										</select>
									</div>
								</div>
							</div>
						</div>
						<div class="uk-width-1-1 narrow-div">
							<div class="uk-form-horizontal">
								<div class="uk-margin">
									<label
										class="uk-form-label"
										for="tx-count"
										>Transaction Limit<span
											uk-icon="icon: info;"
											uk-tooltip
											title="Maximum number of transactions to export. Blank or 0 equals unlimited but only effective if using a custom server."
										></span>
									</label>
									<div class="uk-form-controls">
										<div class="uk-inline uk-width-1-1">
											<input
												[(ngModel)]="csvCount"
												class="uk-input uk-margin-small-bottom {{ invalidCsvCount ? 'uk-form-danger' : '' }}"
												id="tx-count"
												type="text"
												(ngModelChange)="csvCountChange(csvCount)"
												placeholder=""
												autocomplete="off"
											/>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="uk-width-1-1 narrow-div">
							<div class="uk-form-horizontal">
								<div class="uk-margin">
									<label
										class="uk-form-label"
										for="tx-order"
										>Transaction Order</label
									>
									<div class="uk-form-controls">
										<div class="uk-inline uk-width-1-1">
											<select
												class="uk-select"
												[(ngModel)]="selectedOrder"
												id="tx-order"
											>
												@for (option of orderOptions; track option) {
													<option [ngValue]="option.value">
														{{ option.name }}
													</option>
												}
											</select>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="uk-width-1-1 narrow-div">
							<div class="uk-form-horizontal">
								<div class="uk-margin">
									<label
										class="uk-form-label"
										for="tx-offset"
										>Offset (optional)<span
											uk-icon="icon: info;"
											uk-tooltip
											title="Start the export after this index. 10 means starting at transaction 11. Blank or 0 equals no offset."
										></span
									></label>
									<div class="uk-form-controls">
										<div class="uk-inline uk-width-1-1">
											<input
												[(ngModel)]="csvOffset"
												class="uk-input uk-margin-small-bottom {{ invalidCsvOffset ? 'uk-form-danger' : '' }}"
												id="tx-offset"
												type="text"
												(ngModelChange)="csvOffsetChange(csvOffset)"
												placeholder=""
												autocomplete="off"
											/>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			}
			<div class="uk-card-footer uk-text-right@s uk-text-center nlt-button-group">
				@if (!csvExportStarted) {
					<button
						class="uk-button uk-button-primary uk-width-1-1@s uk-width-auto@m uk-float-right"
						type="button"
						[disabled]="!settings.serverAPI"
						(click)="csvInit()"
					>
						{{ settings.serverAPI ? 'GET STARTED' : 'NOT AVAILABLE IN OFFLINE MODE' }}
					</button>
				}
				@if (csvExportStarted && !exportingCsv) {
					<button
						class="uk-button uk-button-primary uk-width-1-1@s uk-width-auto@m uk-float-right"
						type="button"
						[disabled]="!exportEnabled"
						(click)="exportToCsv()"
					>
						{{ exportEnabled ? 'EXPORT HISTORY' : 'COOLDOWN' }}
					</button>
				}
				@if (csvExportStarted && exportingCsv) {
					<button
						class="uk-button uk-button-secondary uk-disabled uk-width-1-1@s uk-width-auto@m uk-float-right nlt-icon-button nlt-icon-button-inline"
						type="button"
					>
						<span
							class="uk-margin-right"
							uk-spinner="ratio: 0.5;"
						></span
						>FETCHING HISTORY...
					</button>
				}
			</div>
		</div>
	</div>
</div>
